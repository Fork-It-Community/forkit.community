---
import { Logo } from "@/components/Logo/Logo";
import { buttonVariants } from "@/components/ui/button";
import EventLayout from "@/layouts/EventLayout.astro";
import { getEventsCollection, getEventSubPagesCollection } from "@/lib/events";
import dayjs from "dayjs";

export async function getStaticPaths() {
  const events = await getEventsCollection();

  return Promise.all(
    events.map(async (event) => ({
      params: { id: event.id },
      props: {
        event,
        subPages: await getEventSubPagesCollection(event),
      },
    })),
  );
}

const { event, subPages } = Astro.props;
---

<EventLayout event={event}>
  <div class="flex h-[80svh] flex-col items-center justify-center">
    <div class="flex flex-col items-center justify-center gap-8 p-4">
      <Logo className="w-48" />
      <h1 class="flex flex-col gap-2 text-balance text-center font-heading">
        <span class="text-4xl font-medium md:text-6xl">
          {dayjs(event.data.date).format("MMMM DD, YYYY")}
        </span>
        <span class="text-2xl text-primary md:text-4xl"
          >{event.data.city}, {event.data.country}</span
        >
      </h1>
      <div class="flex flex-wrap gap-4">
        <a href="#" class={buttonVariants({})}> Get Your Ticket </a>
        <a href="#" class={buttonVariants({ variant: "ghost" })}> CFP </a>
      </div>
    </div>
  </div>

  <div>Event page {event.data.name}</div>
  <ul>
    {
      subPages.map((subPage) => (
        <li>
          <a href={`/events/${subPage.id}`}>{subPage.data.title}</a>
        </li>
      ))
    }
  </ul>
</EventLayout>
