---
import EventLayout from "@/layouts/EventLayout.astro";
import { getEventsCollection, getEventSubPagesCollection } from "@/lib/events";
import { Image } from "astro:assets";

export async function getStaticPaths() {
  const events = await getEventsCollection();

  return Promise.all(
    events.map(async (event) => ({
      params: { id: event.id },
      props: {
        event,
        subPages: await getEventSubPagesCollection(event),
      },
    })),
  );
}

const { event, subPages } = Astro.props;
---

<EventLayout>
  {
    !!event?.data.image?.src && (
      <Image
        src={event.data.image.src}
        alt={event.data.image?.alt}
        width={1000}
        height={1000}
        class="absolute inset-0 -z-10 my-0 h-full min-w-full object-cover object-center"
      />
    )
  }
  <div>Event page {event.data.name}</div>
  <ul>
    {
      subPages.map((subPage) => (
        <li>
          <a href={`/events/${subPage.id}`}>{subPage.data.title}</a>
        </li>
      ))
    }
  </ul>
</EventLayout>
