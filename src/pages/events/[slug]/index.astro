---
import EventLayout from "@/layouts/EventLayout.astro";
import { getEventsCollection } from "@/lib/collections";
import { getEntries } from "astro:content";
import { SEO } from "astro-seo";
import Hero from "./hero.astro";
import Nav from "./nav.astro";
import Venue from "./venue.astro";
import type { CollectionEntry } from "astro:content";

export async function getStaticPaths() {
  const events = await getEventsCollection();

  return Promise.all(
    events.map(async (event) => {
      const subPages = event.data.subPages.map((subPage) => {
        return {
          collection:
            "eventsSubPages" as CollectionEntry<"eventsSubPages">["collection"],
          slug: subPage.slug,
        };
      });
      return {
        params: { slug: event.slug },
        props: {
          event,
          subPages: await getEntries(subPages),
        },
      };
    }),
  );
}

// const { slug } = Astro.params;
// const { subPages, event } = Astro.props;
const { event } = Astro.props;
---

<EventLayout event={event}>
  <SEO slot="seo" />
  <Hero event={event} />
  <div class="container flex flex-col gap-8">
    <Nav event={event} />
    <Venue event={event.data} />
  </div>
</EventLayout>
