---
import MainLayout from "@/layouts/MainLayout.astro";
import MainPageTitle from "@/components/MainPageTitle/index.astro";
import { SEO } from "astro-seo";
import bgImage from "@/assets/images/conferences.png";
import EventSection from "@/components/Conferences/EventSection.astro";
import { getEventsCollection } from "@/lib/events";
import type { GetStaticPathsOptions } from "astro";
import { cn } from "@/lib/utils-client";
import { MdArrowBack, MdArrowForward } from "react-icons/md";
import { buttonVariants } from "@/components/ui/button";

export async function getStaticPaths({ paginate }: GetStaticPathsOptions) {
  const events = await getEventsCollection();

  const eventWithPublicTalks = events.filter(
    (event) =>
      event.data.status === "published" &&
      event.data.schedule?.status !== "preview" &&
      (event.data.schedule?.items ?? []).length > 0,
  );

  return paginate(eventWithPublicTalks, { pageSize: 5 });
}

const { page } = Astro.props;
const events = page.data;
---

<MainLayout>
  <SEO
    slot="seo"
    title="Conferences"
    description="All the Fork it! conferences, from meetups to full-day events! Explore the talks, speakers, and highlights from all editions."
  />
  <MainPageTitle
    title="Conferences"
    subtitle="All the Fork it! Conferences"
    imageSrc={bgImage}
  />
  <div class="mx-auto flex max-w-screen-lg flex-col gap-16 px-4 pb-40">
    <div class="flex flex-col gap-16">
      {events.map((event) => <EventSection event={event} />)}
    </div>
    <div class="flex items-center justify-between md:col-span-2">
      {
        !!page.url.prev && (
          <a
            href={page.url.prev}
            class={cn(buttonVariants({ variant: "secondary" }), "gap-2")}
          >
            <MdArrowBack /> Newer
            <span class="max-xs:sr-only">conferences</span>
          </a>
        )
      }
      {
        !!page.url.next && (
          <a
            href={page.url.next}
            class={cn(
              buttonVariants({ variant: "secondary" }),
              "ml-auto gap-2",
            )}
          >
            Older <span class="max-xs:sr-only">conferences</span>
            <MdArrowForward />
          </a>
        )
      }
    </div>
  </div>
</MainLayout>
