---
import { cn } from "@/lib/utils-client";

interface Props {
  className?: string;
  label?: string;
}

const { className, label = "Cookie Settings" } = Astro.props;
---

<button
  type="button"
  class={cn("orejime-settings-trigger", "cursor-pointer", className)}
>
  <slot>{label}</slot>
</button>

<script>
  function setupCookieSettings() {
    const buttons = document.querySelectorAll(".orejime-settings-trigger");

    if (!buttons.length) return;

    buttons.forEach((button) => {
      button.addEventListener("click", () => {
        if (window.orejime && typeof window.orejime.prompt === "function") {
          window.orejime.prompt();
          return;
        }
      });
    });
  }

  if (document.readyState === "loading") {
    document.addEventListener("DOMContentLoaded", () => {
      setTimeout(setupCookieSettings, 500);
    });
  } else {
    setTimeout(setupCookieSettings, 500);
  }

  window.addEventListener("orejime:ready", setupCookieSettings);
</script>
